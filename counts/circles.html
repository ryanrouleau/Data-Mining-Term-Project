<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>

    <body>
        <svg width="800" height="800" class="chart">

        </svg>
    </body>

    <style>
        body {
            font-family: sans-serif;
        }
        g {
            isolation: isolate;
        }
        circle {
            mix-blend-mode: soft-light;
        }
        .table-container {
            width: 800px;
            text-align: center;
        }
        .key {
            position: absolute;
            top: 20;
            left: 615;
            text-align: center;
        }
        .key td {
            min-width: 40px;
        }
        .key td:nth-of-type(2) {
            padding-left: 15px;
        }
        .date {
            width:120px;
            margin: auto;
            font-family: sans-serif;
        }
        .date td {
            width: 60px;
            text-align: center;
        }
        button {
            margin-top: 20px;
        }
    </style>

    <script>

    var centers = [
        [-87.6710714285714,41.996,0],
        [-87.9047857142857,41.996,1],
        [-87.7879285714286,41.942,2],
        [-87.6710714285714,41.888,3],
        [-87.7879285714286,41.834,4],
        [-87.6710714285714,41.78,5],
        [-87.5542142857143,41.726,6],
        [-87.6710714285714,41.672,7]
    ];
    var colors = [
        "#FF0000",
        "#FF69B4",
        "#FFA500",
        "#00FF7F",
        "#0000FF",
        "#000080",
        "#EE82EE",
        "#9400D3",
    ];
    var margin = {top: 20, right: 15, bottom: 60, left: 60}
    var width = 800 - margin.left - margin.right
    var height = 800 - margin.top - margin.bottom;
    // width,height 726px
    // 0.35 total lat/long in graph
    // 1320px per 1 lat/long
    // so radius scaled is 1320*0.07956066 = 105px
    var x = d3.scaleLinear()
              .domain([-88, -87.45])
              .range([ 0, width ]);

    var y = d3.scaleLinear()
              .domain([41.55, 42.1])
              .range([ height, 0 ]);

    var chart = d3.select('.chart');

    var main = chart.append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
        .attr('width', width)
        .attr('height', height)
        .attr('class', 'main');

    // draw the x axis
    var xAxis = d3.axisBottom()
        .scale(x);

    main.append('g')
        .attr('transform', 'translate(0,' + height + ')')
        .attr('class', 'main axis date')
        .call(xAxis);

    // draw the y axis
    var yAxis = d3.axisLeft()
        .scale(y);

    main.append('g')
        .attr('transform', 'translate(0,0)')
        .attr('class', 'main axis date')
        .call(yAxis);

    var g = main.append("svg:g");

    g.selectAll("scatter-dots")
        .data(centers)
        .enter().append("svg:circle")
        .attr("cx", function (d,i) { return x(d[0]); })
        .attr("cy", function (d) { return y(d[1]); })
        .attr("r", 5)
        .style("fill", function(d) {
            return colors[d[2]]
        });
    g.selectAll("scatter-dots")
        .data(centers)
        .enter().append("svg:circle")
        .attr("cx", function(d,i) { return x(d[0]); })
        .attr("cy", function(d) { return y(d[1]); })
        .attr("r", 105)
        .attr("stroke-width", 2)
        .style("fill", "rgba(0,0,0,0)")
        .style("stroke", function(d) {
            return colors[d[2]]
        });

        /*
        var countMatrixLoaded = false;
        var centersLoaded = false;
        var countMatrixDic = [];
        var centersDic = [];
        d3.csv("./countMatrix.csv", function(data) {
            countMatrixDic = data;
            countMatrixLoaded = true;
            runAnimation()
        });
        d3.csv("./centers.csv", function(data) {
            centersDic = data;
            centersLoaded = true;
            runAnimation()
        });

        function runAnimation() {

            // dealing with async loading of csv
            if (!countMatrixLoaded || ! centersLoaded) {
                return;
            }

            var countMatrix = []
            var centers = []
            for (i = 1; i < countMatrixDic.length; i++) {
                arr = []
                for (j = 0; j < 8; j++) {
                    arr.push(countMatrixDic[i][j]);
                }
                countMatrix.push(arr);
                //countMatrix.append([for (key of countMatrixDic[i].items() [key, countMatrixDic[i][key]])])
            }
            for (i = 0; i < centersDic.length; i++) {
                centers.push([parseFloat(centersDic[i]['lat']), parseFloat(centersDic[i]['long'])]);
            }

            console.log(centers);
            //console.log(data[0])


            var margin = {top: 20, right: 15, bottom: 60, left: 60}
            var width = 800 - margin.left - margin.right
            var height = 800 - margin.top - margin.bottom;
            // width,height 726px
            // 0.35 total lat/long in graph
            // 2,074.29px per 1 lat/long
            // so radius scaled is 2,074.28*0.07956066 = 165px
            var x = d3.scaleLinear()
                      .domain([-88, -87.45])
                      .range([ 0, width ]);

            var y = d3.scaleLinear()
                      .domain([41.55, 42.1])
                      .range([ height, 0 ]);

            var chart = d3.select('.chart');
            console.log(chart)
            */
            /*.append('svg:svg')
            .attr('width', width + margin.right + margin.left)
            .attr('height', height + margin.top + margin.bottom)
            .attr('class', 'chart')*/
            /*
            var main = chart.append('g')
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .attr('width', width)
                .attr('height', height)
                .attr('class', 'main');

            // draw the x axis
            var xAxis = d3.axisBottom()
                .scale(x);

            main.append('g')
                .attr('transform', 'translate(0,' + height + ')')
                .attr('class', 'main axis date')
                .call(xAxis);

            // draw the y axis
            var yAxis = d3.axisLeft()
                .scale(y);

            main.append('g')
                .attr('transform', 'translate(0,0)')
                .attr('class', 'main axis date')
                .call(yAxis);
                */
            /*
            var heatmapColor = d3.scaleQuantize()
                .domain([0,1000])
                .range(["#5E4FA2", "#3288BD", "#66C2A5", "#ABDDA4", "#E6F598",
                "#FFFFBF", "#FEE08B", "#FDAE61", "#F46D43", "#D53E4F", "#9E0142"]);
*/              /*
            var heatmapColor = d3.scaleLinear()
              .domain([0, 700])
              //.range(["#0900F6", "F5000A"]);
              .range(["#6363FF",  "#FF6364"]);

            var g = main.append("svg:g");

            console.log('!!!');
            console.log("test");

            for (k = 0; k < centers.length; k++) {
                centers[k][2] = countMatrix[j][k];
            }
            */
            /*centers.sort(sortFunc);
            function sortFunc(a, b) {
                if (a[2] === b[2]) {
                    return  0;
                }
                else {
                    return (a[2] < b[2]) ? -1 : 1;
                }
            }*/
            /*
            console.log(centers);

            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
            var year = 2001;
            //countMatrix.reverse();
            var monthI = 1;
            var monthEl = document.getElementById("month");
            var yearEl = document.getElementById("year");
            for (j = 0; j < countMatrix.length; j++) {
                (function (j) {
                    setTimeout(function () {
                        month = months[monthI % 12];
                        if (monthI % 12 == 0) {
                            year++;
                        }
                        monthI++;
                        monthEl.textContent = month;
                        yearEl.textContent = year;
                        d3.selectAll("circle")
                            .remove();
                        console.log(j);
                        var data = centers;
                        for (k = 0; k < centers.length; k++) {
                            data[k][2] = countMatrix[j][k];
                        }
                        console.log(data)

                        g.selectAll("scatter-dots")
                            .data(data)
                            .enter().append("svg:circle")
                            .attr("cx", function (d,i) { return x(d[0]); } )
                            .attr("cy", function (d) { return y(d[1]); } )
                            .attr("r", 165)
                            .style("fill", function(d) {
                                return heatmapColor(d[2])
                            });
                    }, 50*j)
                })(j);
            }
        }
        */
    </script>
</html>
